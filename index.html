<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ° C9 1íšŒì°¨ ë‚­í”Œë‹¨</title>

<style>
body {
    background: #FFF7F1;
    font-family: "Pretendard", system-ui, sans-serif;
    display: flex;
    justify-content: center;
    padding: 40px;
    color: #5b3b3b;
}

.wrap {
    width: 100%;
    max-width: 900px;
}

/* ì œëª© */
h1 {
    text-align: center;
    margin-bottom: 16px;
    color: #FF9DB5;
    font-weight: 800;
    font-size: 20px;
}

/* í…Œì´ë¸” */
.table {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

/* í–‰ êµ¬ì¡° (í•¸ë“¤ í¬í•¨í•´ì„œ 8ì¹¸) */
.row {
    display: grid;
    grid-template-columns: 40px 1.1fr 1.2fr 1fr 1fr 1.4fr 1fr 1.4fr;
    background: white;
    border-radius: 6px;
    overflow: hidden;
}

/* ì…€ */
.cell {
    padding: 6px;
    font-size: 13px;
    border-right: 1px solid #ffd9eb;
    border-bottom: 1px solid #ffd9eb;
    text-align: center;
    outline: none;
    contenteditable: plaintext-only;
    white-space: nowrap;
    user-select:text;
}

.cell:last-child { border-right: none; }

/* ë“œë˜ê·¸ í•¸ë“¤ */
.handle {
    background:#ffe6f4;
    border-right:1px solid #ffcadf;
    cursor:grab;
    contenteditable: false !important;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:14px;
    user-select:none;
}

/* ì„ íƒ ê°•ì¡° */
.row.selected {
    outline: 2px solid #ff8aba;
}

/* í—¤ë” */
.header .cell, .header .handle {
    background: #FFE9F3;
    color: #D05B87;
    font-weight: 700;
    border-bottom: 2px solid #f5bad2;
    contenteditable: false;
}

/* ìƒ‰ìƒ íŒ”ë ˆíŠ¸ */
:root {
    --lv1: #FFF6FB;
    --lv2: #FFEFF7;
    --lv3: #FFE6F3;
    --lv4: #FFDEEF;
    --lv5: #FFD5EB;
    --lv6: #FFCDE6;
    --lv7: #FFC5E2;
    --lv8: #FFBCD9;
    --lv9: #FFB2D0;
}

/* ë©”ë‰´ */
.context-menu {
    position: absolute;
    background: white;
    border: 1px solid #e4b7cc;
    border-radius: 10px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
    padding: 6px;
    z-index: 9999;
    font-size: 14px;
    min-width: 140px;
}
.context-menu div {
    padding: 8px 10px;
    color: #d94872;
    text-align: center;
}
.context-menu div:hover {
    background: #ffe6f1;
    cursor: pointer;
}
</style>
</head>
<body>
<div class="wrap">

    <h1>ğŸ° C9 1íšŒì°¨ ë‚­í”Œë‹¨</h1>

    <div class="table">

        <!-- í—¤ë” í–‰ -->
        <div class="row header" data-nodrag="true">
            <div class="handle">â‹®â‹®</div>
            <div class="cell">ì•„ì´ë””</div>
            <div class="cell">ë‹‰ë„¤ì„</div>
            <div class="cell">ê°¯ìˆ˜</div>
            <div class="cell">ì›í”Œì›</div>
            <div class="cell">ê³µì•½</div>
            <div class="cell">ì—­íŒ¬</div>
            <div class="cell">ë¹„ê³ </div>
        </div>

        <!-- ìƒ˜í”Œ -->
        <div class="row" data-amount="30000">
            <div class="handle">â‹®â‹®</div>
            <div class="cell">danggun</div>
            <div class="cell">ë‹¹êµ°</div>
            <div class="cell">30000</div>
            <div class="cell">1</div>
            <div class="cell">ì¶œì„</div>
            <div class="cell calc-ygp"></div>
            <div class="cell">VIP</div>
        </div>

    </div>
</div>

<script>
const COLS = 7;
const isMobile = 'ontouchstart' in window;

/* ------------------------------------------------
ì…€ ê°œìˆ˜ ê³ ì • (7ê°œ ìœ ì§€)
------------------------------------------------ */
function normalizeCells(){
    document.querySelectorAll(".row:not(.header)").forEach(row => {
        let cells = row.querySelectorAll(".cell");
        if(cells.length < COLS){
            for(let i = cells.length; i < COLS; i++){
                const c = document.createElement("div");
                c.className = "cell";
                c.setAttribute("contenteditable", "plaintext-only");
                row.appendChild(c);
            }
        }
    });
}
document.addEventListener("input", normalizeCells);


/* ------------------------------------------------
ìƒ‰ìƒ + ì—­íŒ¬ ê³„ì‚°
------------------------------------------------ */
function applyRowLogic() {
    document.querySelectorAll(".row:not(.header)").forEach(row => {
        const amount = Number(row.querySelectorAll(".cell")[2]?.innerText || 0);
        row.dataset.amount = amount;

        const fanCell = row.querySelector(".calc-ygp");
        if(fanCell) fanCell.textContent = Math.round(amount * 0.03);

        let lv = "--lv1";
        if(amount >= 299 && amount <= 999) lv = "--lv2";
        else if(amount >= 1000 && amount <= 2999) lv = "--lv3";
        else if(amount >= 3000 && amount <= 4999) lv = "--lv4";
        else if(amount >= 5000 && amount <= 9999) lv = "--lv5";
        else if(amount >= 10000 && amount <= 49999) lv = "--lv6";
        else if(amount >= 50000 && amount <= 99999) lv = "--lv7";
        else if(amount >= 100000 && amount <= 299999) lv = "--lv8";
        else if(amount >= 300000) lv = "--lv9";

        row.style.background = `var(${lv})`;
    });
}

/* ------------------------------------------------
í–‰ ì„ íƒ (Shift ì§€ì›)
------------------------------------------------ */
let lastIndex=null;

document.addEventListener("click", e=>{
    const row = e.target.closest(".row:not(.header)");
    if(!row) return;

    const rows=[...document.querySelectorAll(".row:not(.header)")];
    const index=rows.indexOf(row);

    if(e.shiftKey && lastIndex!==null){
        rows.forEach(r=>r.classList.remove("selected"));
        const [s,e2]=[lastIndex,index].sort((a,b)=>a-b);
        for(let i=s;i<=e2;i++) rows[i].classList.add("selected");
    } else {
        rows.forEach(r=>r.classList.remove("selected"));
        row.classList.add("selected");
        lastIndex=index;
    }
});

/* ------------------------------------------------
ì»¨í…ìŠ¤íŠ¸ ë©”ë‰´
------------------------------------------------ */
document.querySelectorAll(".row:not(.header)").forEach(row=>{
    row.addEventListener("contextmenu",e=>{
        showContextMenu(e,row);
    });
});

document.querySelectorAll(".row:not(.header)").forEach(row=>{
    let t;
    row.addEventListener("touchstart",e=>{
        t=setTimeout(()=>showContextMenu(e,row),500);
    });
    row.addEventListener("touchend",()=>clearTimeout(t));
});

function showContextMenu(event,row){
    document.querySelectorAll(".context-menu").forEach(e=>e.remove());
    window.selectedRow=row;

    const menu=document.createElement("div");
    menu.className="context-menu";

    const x=(event.clientX||event.touches?.[0].clientX)+130;
    const y=(event.clientY||event.touches?.[0].clientY)-10;

    menu.style.left=x+"px";
    menu.style.top=y+"px";

    menu.innerHTML=`
        <div onclick="insertRow(selectedRow,'above')">â–² ìœ„ì— í–‰ ì‚½ì…</div>
        <div onclick="insertRow(selectedRow,'below')">â–¼ ì•„ë˜ í–‰ ì‚½ì…</div>
        <div onclick="deleteSelectedRows()">ğŸ—‘ ì„ íƒëœ í–‰ ì‚­ì œ</div>
    `;
    document.body.appendChild(menu);
}

/* ------------------------------------------------
í–‰ ì‚½ì…
------------------------------------------------ */
function insertRow(baseRow,pos){
    const table=document.querySelector(".table");
    const newRow=document.createElement("div");

    newRow.className="row";
    newRow.innerHTML=`
        <div class="handle">â‹®â‹®</div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell">0</div>
        <div class="cell"></div>
        <div class="cell"></div>
        <div class="cell calc-ygp"></div>
        <div class="cell"></div>
    `;

    if(pos==="above") table.insertBefore(newRow,baseRow);
    else table.insertBefore(newRow,baseRow.nextSibling);

    applyRowLogic();
    normalizeCells();
    enableDrag();
}

/* ------------------------------------------------
í–‰ ì‚­ì œ
------------------------------------------------ */
function deleteSelectedRows(){
    document.querySelectorAll(".row.selected").forEach(r=>r.remove());
    document.querySelectorAll(".context-menu").forEach(e=>e.remove());
}

/* ------------------------------------------------
ë“œë˜ê·¸ (í•¸ë“¤ë§Œ)
------------------------------------------------ */
function enableDrag(){
    const rows=document.querySelectorAll(".row:not(.header)");

    rows.forEach(row=>{
        const handle=row.querySelector(".handle");

        // ë“œë˜ê·¸ ìƒíƒœ ì´ˆê¸°í™”
        row.draggable=false;
        handle.addEventListener("longpressstart",()=>{});

        // PC ë“œë˜ê·¸ ì‹œì‘
        handle.addEventListener("mousedown",(e)=>{
            if(window.getSelection().toString()!=="") return;
            row.draggable=true;
        });

        handle.addEventListener("mouseup",()=>row.draggable=false);

        // ëª¨ë°”ì¼ ê¸¸ê²Œ ëˆ„ë¥¼ ë•Œë§Œ ë“œë˜ê·¸ ì‹œì‘
        handle.addEventListener("touchstart",()=>{
            setTimeout(()=>row.draggable=true,400);
        });
        handle.addEventListener("touchend",()=>row.draggable=false);

        row.addEventListener("dragstart",()=>{
            row.classList.add("dragging");
            row.querySelectorAll(".cell").forEach(c=>c.setAttribute("contenteditable","false"));
        });

        row.addEventListener("dragend",()=>{
            row.classList.remove("dragging");
            row.querySelectorAll(".cell").forEach(c=>c.setAttribute("contenteditable","plaintext-only"));
            row.draggable=false;
            applyRowLogic();
        });
    });

    const table=document.querySelector(".table");
    table.addEventListener("dragover",e=>{
        const dragging=document.querySelector(".dragging");
        const rowsArr=[...table.querySelectorAll(".row:not(.header)")];
        const after=rowsArr.find(r=>{
            const rect=r.getBoundingClientRect();
            return e.clientY < rect.top + rect.height/2;
        });
        if(after) table.insertBefore(dragging,after);
        else table.appendChild(dragging);
    });
}
enableDrag();

/* ------------------------------------------------
CTRL+C / CTRL+V ë³µì‚¬
------------------------------------------------ */
let copiedRows=[];
document.addEventListener("keydown",e=>{
    const rows=[...document.querySelectorAll(".row:not(.header)")];
    const selected=rows.filter(r=>r.classList.contains("selected"));

    if(e.ctrlKey && e.key==="c"){
        copiedRows=selected.map(r=>r.outerHTML);
    }

    if(e.ctrlKey && e.key==="v" && copiedRows.length){
        const table=document.querySelector(".table");
        copiedRows.forEach(html=>{
            const div=document.createElement("div");
            div.innerHTML=html;
            table.appendChild(div.firstChild);
        });
        applyRowLogic();
        normalizeCells();
        enableDrag();
    }
});

/* ì´ˆê¸° ì‹¤í–‰ */
normalizeCells();
applyRowLogic();
</script>

</body>
</html>
